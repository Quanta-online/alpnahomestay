<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alpana Group — Candidate Results Portal (Aug 2025)</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    :root{
      --primary:#0f2a4d; --accent:#0ea5e9; --muted:#6b7280; --success:#16a34a; --danger:#dc2626;
      --card:#ffffff; --radius:14px; --shadow:0 18px 60px rgba(10,25,40,0.08);
      --mono:'Roboto Mono', monospace; --ui:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:var(--ui);color:var(--primary);-webkit-font-smoothing:antialiased}
    a{color:var(--accent);text-decoration:none}
    /* Background (blurred hotel image from Unsplash) */
    body::before{content:"";position:fixed;inset:0;z-index:-2;
      background-image:url('https://images.unsplash.com/photo-1501117716987-c8e2a6bf6f7b?auto=format&fit=crop&w=1800&q=80');
      background-size:cover;background-position:center;filter:blur(6px) saturate(0.9) brightness(0.82);transform:scale(1.04)}
    body::after{content:"";position:fixed;inset:0;z-index:-1;background:linear-gradient(180deg,rgba(255,255,255,0.65),rgba(255,255,255,0.85))}

    .container{max-width:1200px;margin:34px auto;padding:0 18px}
    nav{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{height:56px;border-radius:8px;object-fit:contain;box-shadow:0 8px 30px rgba(10,25,40,0.06)}
    .brand .title{font-weight:800;font-size:1.05rem}
    .nav-actions{display:flex;gap:10px;align-items:center}
    .nav-actions button, .nav-actions a{padding:8px 12px;border-radius:10px;border:none;background:rgba(255,255,255,0.92);cursor:pointer}
    .nav-actions button.cta{background:linear-gradient(90deg,var(--primary),#163b6a);color:white;font-weight:700}

    /* Splash */
    #splash{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;background:transparent}
    .splash-card{background:rgba(255,255,255,0.98);padding:28px;border-radius:18px;box-shadow:var(--shadow);display:flex;gap:22px;align-items:center;flex-direction:column;max-width:880px}
    .splash-logos{display:flex;gap:18px;align-items:center}
    .splash-logos img{height:96px;object-fit:contain;border-radius:10px}
    .splash-title{font-size:1.6rem;font-weight:800;color:var(--primary)}
    .splash-sub{color:var(--muted)}
    .splash-progress{margin-top:16px;height:8px;background:#eef7ff;border-radius:999px;width:520px;overflow:hidden}
    .splash-progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--primary));animation:load 40s linear forwards}
    @keyframes load{to{width:100%}}

    main.portal{margin-top:18px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.95));border-radius:16px;box-shadow:var(--shadow);overflow:hidden;backdrop-filter: blur(6px)}
    .panel{display:grid;grid-template-columns:1fr 380px;gap:22px;padding:22px}
    @media(max-width:980px){.panel{grid-template-columns:1fr;padding:16px}}

    .left{display:flex;flex-direction:column;gap:12px}
    .searchbar{display:flex;gap:10px;margin-top:10px}
    .searchbar input{flex:1;padding:14px 16px;border-radius:12px;border:1px solid rgba(15,25,40,0.06);font-size:1rem;background:rgba(255,255,255,0.98)}
    .searchbar button{padding:12px 14px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--primary),#163b6a);color:white;font-weight:800;cursor:pointer}
    .hint{color:var(--muted);font-size:0.92rem;margin-top:8px}

    .suggestion-box{margin-top:8px;background:rgba(255,255,255,0.98);border-radius:12px;border:1px solid #eef6fb;overflow:auto;max-height:220px;display:none}
    .suggestion-item{padding:12px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #f6fbff;cursor:pointer}
    .suggestion-item:hover{background:#f4fbff}

    .result-area{margin-top:16px}
    .locked{border-radius:12px;padding:18px;background:linear-gradient(180deg,#fff,#fcfeff);border:1px solid #eef6fb;display:flex;align-items:center;gap:14px}
    .card-result{display:none;border-radius:12px;padding:18px;background:linear-gradient(180deg,#fff,#fcfeff);border:1px solid #eef6fb;box-shadow:0 8px 30px rgba(10,25,40,0.04)}
    .result-header{display:flex;gap:18px;align-items:center}
    .ring{width:120px;height:120px;border-radius:999px;display:flex;align-items:center;justify-content:center;box-shadow:0 12px 28px rgba(14,165,233,0.06)}
    .candidate{flex:1}
    .candidate h2{margin:0;font-size:1.15rem}
    .candidate .meta{font-family:var(--mono);color:var(--muted);margin-top:6px}
    .meta-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    .meta-box{background:#fff;padding:12px;border-radius:10px;border:1px solid #f1f6fb}
    .actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}

    .right{display:flex;flex-direction:column;gap:12px}
    .stat-card{padding:14px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfcff);border:1px solid #eef6fb}
    .stat-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px dashed #f1f6fb}
    .top-list{max-height:300px;overflow:auto;margin-top:8px}
    .top-item{display:flex;justify-content:space-between;padding:8px;border-radius:8px}

    .modal-back{position:fixed;inset:0;background:rgba(10,20,30,0.45);display:none;align-items:center;justify-content:center;z-index:10005}
    .modal{width:420px;background:#fff;padding:18px;border-radius:12px;box-shadow:0 20px 60px rgba(10,20,40,0.2)}
    .modal h3{margin:0 0 8px 0}
    .field{margin-top:10px}
    .field input{width:100%;padding:10px;border-radius:8px;border:1px solid #eef6fb}

    @media(max-width:640px){ .ring{width:96px;height:96px} .panel{grid-template-columns:1fr} .brand img{height:44px} .splash-logos img{height:72px} }
    @media print{ body *{visibility:hidden} .card-result, .card-result *{visibility:visible} .card-result{position:fixed;left:0;top:0;width:100%} }
  </style>
</head>
<body>

  <!-- SPLASH -->
  <div id="splash" role="dialog" aria-modal="true">
    <div class="splash-card center" role="document">
      <div class="splash-logos center">
        <img src="new.png" alt="Alpana Group Logo" onerror="this.src='https://via.placeholder.com/220x88?text=Alpana'">
        <img src="https://via.placeholder.com/220x88?text=Alpana+Homestay+%26+Travels" alt="Alpana Homestay & Travels">
      </div>
      <div class="splash-title">Alpana Group — Managerial Aptitude Test</div>
      <div class="splash-sub">Secure candidate portal</div>
      <div class="splash-progress"><i></i></div>
      <div style="margin-top:12px;color:var(--muted);font-size:0.92rem">Please wait — portal is preparing (approx 40s)</div>
    </div>
  </div>

  <div class="container" id="app" aria-hidden="true">
    <nav aria-label="Main navigation">
      <div class="brand">
        <img src="new.png" alt="Alpana Group" onerror="this.src='https://via.placeholder.com/170x56?text=Alpana'">
        <div><div class="title">Alpana Group</div><div style="font-size:0.86rem;color:var(--muted)">Managerial Recruitment — 2025</div></div>
      </div>
      <div class="nav-actions" role="navigation">
        <div id="gsi-placeholder" style="min-width:220px"></div>
        <a href="#" class="cta" id="contactBtn">Contact</a>
        <a href="#" id="adminLink">Admin</a>
      </div>
    </nav>

    <main class="portal" role="main" aria-labelledby="portal-heading">
      <div style="padding:18px 22px 6px 22px;display:flex;justify-content:space-between;align-items:center">
        <div><h3 id="portal-heading" style="margin:0">Candidate Result Portal</h3>
          <div style="color:var(--muted);margin-top:6px">Sign in with Google to view your result when released.</div></div>
        <div style="text-align:right"><div style="color:var(--muted)">DOCUMENT</div><div style="font-family:var(--mono);margin-top:6px">AGRS-2025-08-196-RESULTS-V3</div></div>
      </div>

      <div class="panel">
        <div class="left">
          <div class="hero"><div style="font-weight:700">Find your result</div><div style="color:var(--muted)">Private & secure</div></div>

          <div class="searchbar" role="search">
            <input id="searchInput" type="text" placeholder="Application No (ALP2025A10001) or candidate name..." aria-label="Search" />
            <button id="searchBtn" class="btn-primary" disabled>View Result</button>
          </div>

          <div class="hint" id="hintText">Please sign in to view results when published.</div>
          <div id="suggestionBox" class="suggestion-box" aria-hidden="true"></div>

          <div class="result-area">
            <div id="lockedBox" class="locked" style="display:flex">
              <div><div style="font-weight:800;color:var(--primary)">Results are not yet available</div>
                <div style="color:var(--muted);margin-top:6px">Once released, authenticated candidates can search and view results here.</div></div>
              <div style="margin-left:auto;text-align:center"><div style="font-size:1.05rem;color:var(--muted);font-weight:700">Locked</div>
                <div style="color:var(--muted);font-size:0.86rem;margin-top:6px">Please check back later</div></div>
            </div>

            <div id="cardResult" class="card-result" role="region" aria-live="polite"></div>
            <div id="noResult" style="display:none;margin-top:12px;color:var(--danger);font-weight:700"></div>
          </div>

          <div style="display:flex;gap:10px;margin-top:12px">
            <button id="btnTop20" class="btn-ghost">Show Top 20</button>
            <button id="btnExport" class="btn-ghost">Export CSV</button>
            <button id="btnHelp" class="btn-ghost">Help</button>
          </div>
        </div>

        <aside class="right" aria-label="Summary">
          <div class="stat-card" role="status" aria-live="polite">
            <h4 style="margin:0">Selection Summary</h4>
            <div class="stat-row"><div>Total candidates</div><div id="totalCount">—</div></div>
            <div class="stat-row"><div>GM interviews</div><div id="gmCount">—</div></div>
            <div class="stat-row"><div>Manager interviews</div><div id="mgrCount">—</div></div>
            <div class="stat-row"><div>Not Qualified</div><div id="failCount">—</div></div>
          </div>

          <div class="stat-card">
            <h4 style="margin:0">Top 10</h4>
            <div id="top10" class="top-list" aria-live="polite"><div style="color:var(--muted);margin-top:8px">Top 10 visible after results are published.</div></div>
          </div>

          <div class="stat-card">
            <h4 style="margin:0">Notes</h4>
            <div style="margin-top:8px;color:var(--muted)">
              <div>- Candidates marked <strong>Not Qualified</strong> will not be invited for interview.</div>
              <div style="margin-top:6px">- Final selection: Test (60%) + Interview (40%).</div>
              <div style="margin-top:6px">- For verification: <a href="mailto:recruitment@alpnagroup.com">recruitment@alpnagroup.com</a></div>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <footer style="text-align:center;color:var(--muted);margin-top:18px;padding-bottom:30px">© Alpana Group Human Resources — 2025</footer>
  </div>

  <!-- ADMIN modal -->
  <div id="modalBack" class="modal-back" role="dialog" aria-hidden="true">
    <div class="modal">
      <h3>Admin Login</h3>
      <p style="color:var(--muted)">Administrator access (server-side authentication required).</p>
      <div class="field"><label style="font-size:0.9rem;color:var(--muted)">Username</label><input id="adminUser" type="text" placeholder="Username"></div>
      <div class="field"><label style="font-size:0.9rem;color:var(--muted)">Password</label><input id="adminPass" type="password" placeholder="Password"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="adminCancel" class="btn-ghost">Cancel</button>
        <button id="adminSubmit" class="btn-ghost">Login</button>
      </div>
      <div id="adminMsg" style="margin-top:8px;color:var(--danger);display:none"></div>
    </div>
  </div>

  <script>
  /* CONFIG */
  const RELEASE_ISO = "2025-08-15T19:00:00+05:30"; // internal only
  const releaseTime = new Date(RELEASE_ISO).getTime();
  const GOOGLE_CLIENT_ID = "REPLACE_WITH_YOUR_CLIENT_ID"; // replace for real Google Sign-In

  /* FULL DATA: top-known literal entries + deterministic append to reach 196 */
  const CANDIDATES = [
    {"rank":1,"name":"Aarav Sharma","app":"ALP2025A10001","score":76.25,"percentile":100,"status":"GM Interview"},
    {"rank":2,"name":"Zara Khan","app":"ALP2025B20034","score":74.18,"percentile":99.49,"status":"GM Interview"},
    {"rank":3,"name":"Ishaan Patel","app":"ALP2025C30012","score":72.89,"percentile":98.98,"status":"GM Interview"},
    {"rank":4,"name":"Ananya Singh","app":"ALP2025D40056","score":71.45,"percentile":98.47,"status":"GM Interview"},
    {"rank":5,"name":"Ethan D'Souza","app":"ALP2025E50078","score":70.92,"percentile":97.96,"status":"GM Interview"},
    {"rank":6,"name":"Fatima Ahmed","app":"ALP2025F60023","score":70.33,"percentile":97.44,"status":"GM Interview"},
    {"rank":7,"name":"Arjun Reddy","app":"ALP2025G70045","score":69.87,"percentile":96.93,"status":"GM Interview"},
    {"rank":8,"name":"Meera Nair","app":"ALP2025H80067","score":69.45,"percentile":96.42,"status":"GM Interview"},
    {"rank":9,"name":"David Cohen","app":"ALP2025I90089","score":69.12,"percentile":95.91,"status":"GM Interview"},
    {"rank":10,"name":"Priyanka Banerjee","app":"ALP2025J10101","score":68.95,"percentile":95.4,"status":"GM Interview"},
    {"rank":11,"name":"Marcus Antonius","app":"ALP2025K11123","score":68.72,"percentile":94.89,"status":"GM Interview"},
    {"rank":12,"name":"Aisha Abdullah","app":"ALP2025L12145","score":68.55,"percentile":94.38,"status":"GM Interview"},
    {"rank":13,"name":"Kabir Das","app":"ALP2025M13167","score":68.33,"percentile":93.87,"status":"GM Interview"},
    {"rank":14,"name":"Sophia Rodriguez","app":"ALP2025N14189","score":68.12,"percentile":93.36,"status":"GM Interview"},
    {"rank":15,"name":"Yusuf Öztürk","app":"ALP2025O15201","score":67.95,"percentile":92.85,"status":"GM Interview"},
    {"rank":16,"name":"Riya Chatterjee","app":"ALP2025P16223","score":67.89,"percentile":92.34,"status":"Manager Interview"},
    {"rank":17,"name":"Aryan Khanna","app":"ALP2025Q17245","score":67.45,"percentile":91.83,"status":"Manager Interview"},
    {"rank":18,"name":"Leyla Yılmaz","app":"ALP2025R18267","score":67.32,"percentile":91.32,"status":"Manager Interview"},
    {"rank":19,"name":"Rohan Malhotra","app":"ALP2025S19289","score":67.18,"percentile":90.81,"status":"Manager Interview"},
    {"rank":20,"name":"Nandini Iyer","app":"ALP2025T20301","score":66.95,"percentile":90.3,"status":"Manager Interview"},
    {"rank":151,"name":"Neha Gupta","app":"ALP2025U21323","score":47.12,"percentile":23.47,"status":"Not Qualified"},
    {"rank":152,"name":"Mohit Gangwar","app":"ALP2025C78945","score":46.89,"percentile":22.96,"status":"Not Qualified"},
    {"rank":153,"name":"Thomas Fischer","app":"ALP2025V22345","score":45.67,"percentile":22.45,"status":"Not Qualified"},
    {"rank":195,"name":"Sunil Verma","app":"ALP2025W23367","score":18.92,"percentile":1.53,"status":"Not Qualified"},
    {"rank":196,"name":"Rajesh Kumar","app":"ALP2025X24389","score":16.66,"percentile":0.51,"status":"Not Qualified"}
  ];

  // deterministic append to reach 196 (keeps data reproducible & self-contained)
  (function appendRemaining(){
    if(CANDIDATES.length>=196) return;
    const firsts=["Aditya","Vishal","Kavya","Sana","Ritik","Simran","Kabir","Leena","Nikhil","Priya","Dev","Sameer","Ila","Tara","Vikram","Anika","Rahul","Maya","Karan","Siddharth","Isha","Manav","Kriti","Zayn","Farah","Omar","Hina","Rakesh","Gopal","Sunita","Riya","Arnav","Irfan","Meera","Pooja","Devika","Anjali","Rohit","Shreya","Vibha","Ajay","Liam","Noah","Emma","Olivia","Sophia","Lucas","Mia"];
    const lasts=["Sharma","Patel","Singh","Gupta","Iyer","Reddy","Nair","Chatterjee","Khan","Mehta","Malhotra","Kohli","Bose","D'Silva","Das","Fernando","Rodriguez","Kumar","Verma","Gangwar","Yadav","Joshi","Saxena","Ghosh","Bhattacharya","Rao","Sethi","Kapoor","Arora","Trivedi","Rodrigues","Öztürk","Yılmaz","Antonius","Cohen","D'Souza"];
    function seededRandom(seed){ let a=seed|0; return function(){ a=Math.imul(a+0x6D2B79F5,1); var t=a; t=(t^(t>>>15))*(t|1); t^=t+Math.imul(t^(t>>>7),t|61); return ((t^(t>>>14))>>>0)/4294967296; } }
    const rng = seededRandom(20250815);
    const total=196;
    for(let r=CANDIDATES.length+1;r<=total;r++){
      if(CANDIDATES.find(x=>x.rank===r)) continue;
      const f=firsts[(r*13+7)%firsts.length];
      const l=lasts[(r*17+11)%lasts.length];
      const name=`${f} ${l}`;
      const base=16.66 + (76.25-16.66)*((total - r + 1)/total);
      const jitter=(rng()-0.5)*5.5;
      let score=Math.max(16.7,Math.min(76.24,Math.round((base+jitter)*100)/100));
      const percentile=Math.round(100*(score-16.66)/(76.25-16.66)*100)/100;
      let status="Not Qualified"; if(score>=67.90) status="GM Interview"; else if(score>=55.00) status="Manager Interview";
      const app="ALP2025"+String.fromCharCode(65 + (r%26))+String(10000 + r).padStart(5,'0');
      CANDIDATES.push({rank:r,name:name,app:app,score:score,percentile:percentile,status:status});
    }
  })();

  // Indexes & UI refs
  const appIndex = new Map(CANDIDATES.map(c=>[c.app.toUpperCase(), c]));
  const nameIndex = new Map(CANDIDATES.map(c=>[c.name.toUpperCase(), c]));

  const splash = document.getElementById('splash');
  const appEl = document.getElementById('app');
  const searchInput = document.getElementById('searchInput');
  const searchBtn = document.getElementById('searchBtn');
  const suggestionBox = document.getElementById('suggestionBox');
  const lockedBox = document.getElementById('lockedBox');
  const cardResult = document.getElementById('cardResult');
  const noResult = document.getElementById('noResult');
  const hintText = document.getElementById('hintText');
  const top10El = document.getElementById('top10');

  // Populate summary
  document.getElementById('totalCount').textContent = CANDIDATES.length;
  document.getElementById('gmCount').textContent = CANDIDATES.filter(c=>c.status==='GM Interview').length;
  document.getElementById('mgrCount').textContent = CANDIDATES.filter(c=>c.status==='Manager Interview').length;
  document.getElementById('failCount').textContent = CANDIDATES.filter(c=>c.status==='Not Qualified').length;

  // Utility
  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  function isReleased(){ return Date.now() >= releaseTime; }
  function enableSearchIfAllowed(){ if(isReleased() && window.signedInUser){ searchBtn.disabled=false; hintText.textContent='Enter your Application number or name to view your result.' } else { searchBtn.disabled=true; hintText.textContent='Please sign in to view results when published.' } }

  // Splash hide after 40 seconds
  setTimeout(()=>{ splash.style.opacity='0'; setTimeout(()=>{ splash.style.display='none'; appEl.setAttribute('aria-hidden','false'); },900); },40000);

  // Google Sign-In handling (client-side decode; production must verify token server-side)
  window.handleCredentialResponse = function(response){
    try{
      const payload = JSON.parse(atob(response.credential.split('.')[1]));
      window.signedInUser = { email: payload.email, name: payload.name, picture: payload.picture };
      document.getElementById('gsi-placeholder').innerHTML = `<div style="display:flex;align-items:center;gap:8px"><img src="${window.signedInUser.picture||''}" style="height:32px;border-radius:999px"/><div style="font-size:0.92rem;color:var(--muted)">${escapeHtml(window.signedInUser.email)}</div></div><button id="signOutBtn" class="btn-ghost" style="margin-left:10px">Sign out</button>`;
      document.getElementById('signOutBtn').addEventListener('click', ()=>{ window.signedInUser=null; document.getElementById('gsi-placeholder').innerHTML=''; renderGoogleButton(); enableSearchIfAllowed(); });
      enableSearchIfAllowed();
    }catch(e){ console.error('Failed to parse credential', e); }
  };

  function renderGoogleButton(){
    const holder=document.getElementById('gsi-placeholder');
    if(GOOGLE_CLIENT_ID && GOOGLE_CLIENT_ID!=='REPLACE_WITH_YOUR_CLIENT_ID' && window.google && google.accounts && google.accounts.id){
      google.accounts.id.initialize({ client_id:GOOGLE_CLIENT_ID, callback:handleCredentialResponse, ux_mode:'popup' });
      google.accounts.id.renderButton(holder, { theme:'outline', size:'medium' });
      google.accounts.id.prompt();
    } else {
      holder.innerHTML = '<div style="color:var(--muted);font-size:0.92rem">Google Sign-In (configure client ID)</div>';
    }
  }
  window.addEventListener('load', ()=>{ setTimeout(renderGoogleButton, 800); enableSearchIfAllowed(); });

  // Suggestions + search (only after release and sign-in)
  searchInput.addEventListener('input', (e)=>{
    const q=e.target.value.trim();
    if(!q || !isReleased() || !window.signedInUser){ suggestionBox.style.display='none'; return; }
    const key=q.toUpperCase();
    const matches=CANDIDATES.filter(c=>c.app.toUpperCase().includes(key) || c.name.toUpperCase().includes(key)).slice(0,8);
    if(matches.length===0){ suggestionBox.style.display='none'; return; }
    suggestionBox.innerHTML='';
    matches.forEach(m=>{ const div=document.createElement('div'); div.className='suggestion-item'; div.innerHTML=`<div style="font-weight:700">${escapeHtml(m.name)}</div><div style="font-family:var(--mono);color:var(--muted)">${m.app}</div>`; div.addEventListener('click', ()=>{ searchInput.value=m.app; suggestionBox.style.display='none'; renderCandidate(m); updateUrlParam(m.app); }); suggestionBox.appendChild(div); });
    suggestionBox.style.display='block';
  });

  function lookup(term){
    if(!term) return null;
    const key=term.trim().toUpperCase();
    if(appIndex.has(key)) return appIndex.get(key);
    if(nameIndex.has(key)) return nameIndex.get(key);
    return CANDIDATES.find(c=>c.name.toUpperCase().includes(key) || c.app.toUpperCase().includes(key)) || null;
  }

  function renderCandidate(c){
    noResult.style.display='none'; cardResult.style.display='block';
    const pct=Math.max(0,Math.min(100,Number(c.percentile)||0)); const angle=Math.round(pct*3.6);
    let inviteNote='';
    if(c.status==='Not Qualified') inviteNote=`<div style="margin-top:10px;color:var(--danger);font-weight:800">Not Qualified — will not be invited for interview.</div>`;
    else inviteNote=`<div style="margin-top:10px;color:var(--muted)">Selected for interview stage — invitations will be sent via registered email/SMS.</div>`;
    cardResult.innerHTML=`
      <div class="result-header">
        <div class="ring" style="background:conic-gradient(var(--accent) ${angle}deg,#eef7ff ${angle}deg)">
          <div style="text-align:center"><div class="score">${c.score.toFixed(2)}</div><div style="color:var(--muted);font-size:0.86rem">Score</div></div>
        </div>
        <div class="candidate">
          <h2>${escapeHtml(c.name)}</h2>
          <div class="meta">Application: <span style="font-family:var(--mono)">${c.app}</span> · Rank: <strong>#${c.rank}</strong></div>
          <div class="meta-grid">
            <div class="meta-box"><div class="k">Percentile</div><div class="v">${c.percentile.toFixed(2)}%</div></div>
            <div class="meta-box"><div class="k">Result</div><div class="v">${c.status}</div></div>
            <div class="meta-box"><div class="k">Cutoff</div><div class="v">GM ≥ 67.90 · Mgr 55.00–67.89</div></div>
            <div class="meta-box"><div class="k">Next Steps</div><div class="v">Interview & verification (if applicable)</div></div>
          </div>
          ${inviteNote}
          <div style="margin-top:12px" class="actions">
            <button class="btn-ghost" onclick="window.print()" ${c.status==='Not Qualified'?'title="No interview"':''}>Print / Save PDF</button>
            <button class="btn-ghost" id="copyAppBtn">Copy App No.</button>
            <button class="btn-ghost" id="downloadJsonBtn">Download JSON</button>
            <button class="btn-ghost" id="shareLinkBtn">Copy Share Link</button>
          </div>
        </div>
      </div>
    `;
    document.getElementById('copyAppBtn').addEventListener('click', ()=>{ navigator.clipboard.writeText(c.app).then(()=>alert('Application number copied')); });
    document.getElementById('downloadJsonBtn').addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(c,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`${c.app}_result.json`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
    document.getElementById('shareLinkBtn').addEventListener('click', ()=>{ updateUrlParam(c.app); navigator.clipboard.writeText(location.href).then(()=>alert('Share link copied to clipboard')); });
  }

  // Search button
  searchBtn.addEventListener('click', ()=>{
    if(!isReleased()){ alert('Results are not yet available.'); return; }
    if(!window.signedInUser){ alert('Please sign in with Google to view results.'); return; }
    const q=searchInput.value.trim(); if(!q){ alert('Enter application number or name'); return; }
    const res=lookup(q); if(res){ renderCandidate(res); updateUrlParam(res.app); } else { cardResult.style.display='none'; noResult.style.display='block'; noResult.textContent='No result found. Verify application number or contact recruitment@alpnagroup.com'; }
  });

  // Top20
  document.getElementById('btnTop20').addEventListener('click', ()=>{
    if(!isReleased()){ alert('Results are not yet available.'); return; }
    if(!window.signedInUser){ alert('Please sign in to view top list.'); return; }
    const rows=CANDIDATES.slice(0,20).map(r=>`<tr><td style="padding:6px">${r.rank}</td><td style="padding:6px">${escapeHtml(r.name)}</td><td style="padding:6px;font-family:var(--mono)">${r.app}</td><td style="padding:6px">${r.score.toFixed(2)}</td></tr>`).join('');
    cardResult.style.display='block'; noResult.style.display='none';
    cardResult.innerHTML=`<div style="padding:8px"><strong>Top 20</strong><div style="margin-top:8px"><table style="width:100%;border-collapse:collapse"><thead><tr><th style="text-align:left;padding:6px">Rank</th><th style="text-align:left;padding:6px">Name</th><th style="text-align:left;padding:6px">Application</th><th style="padding:6px">Score</th></tr></thead><tbody>${rows}</tbody></table></div></div>`;
  });

  // Export CSV
  document.getElementById('btnExport').addEventListener('click', ()=>{
    if(!isReleased()){ alert('Results are not yet available.'); return; }
    if(!window.signedInUser){ alert('Please sign in to export results.'); return; }
    const header=['Rank','Candidate Name','Application No.','Score','Percentile','Status'];
    const rows=CANDIDATES.map(c=>[c.rank,c.name,c.app,c.score.toFixed(2),c.percentile.toFixed(2),c.status]);
    const csv=[header,...rows].map(r=>r.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='Alpana_Managerial_Results_Aug2025.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  // Top10 panel render
  function renderTop10IfReleased(){
    if(!isReleased()){ top10El.innerHTML='<div style="color:var(--muted);margin-top:8px">Top 10 visible after results are published.</div>'; return; }
    if(!window.signedInUser){ top10El.innerHTML='<div style="color:var(--muted);margin-top:8px">Sign in to view Top 10.</div>'; return; }
    top10El.innerHTML=''; CANDIDATES.slice(0,10).forEach(t=>{ const wrap=document.createElement('div'); wrap.className='top-item'; wrap.innerHTML=`<div style="display:flex;gap:8px;align-items:center"><strong>#${t.rank}</strong><div style="font-weight:700">${t.name}</div></div><div style="font-family:var(--mono)">${t.score.toFixed(2)}</div>`; top10El.appendChild(wrap); });
  }
  renderTop10IfReleased(); setInterval(renderTop10IfReleased,3000);

  // prefill ?app=
  (function(){ try{ const p=new URLSearchParams(location.search); const a=p.get('app'); if(a) searchInput.value=a; }catch(e){} })();

  // admin modal (client-side placeholder)
  const adminLink=document.getElementById('adminLink'), modalBack=document.getElementById('modalBack'), adminCancel=document.getElementById('adminCancel'), adminSubmit=document.getElementById('adminSubmit'), adminMsg=document.getElementById('adminMsg');
  adminLink.addEventListener('click', (e)=>{ e.preventDefault(); modalBack.style.display='flex'; modalBack.setAttribute('aria-hidden','false'); adminMsg.style.display='none'; });
  adminCancel && adminCancel.addEventListener('click', ()=>{ modalBack.style.display='none'; modalBack.setAttribute('aria-hidden','true'); });
  adminSubmit && adminSubmit.addEventListener('click', ()=>{ const u=document.getElementById('adminUser').value.trim(), p=document.getElementById('adminPass').value.trim(); if(!u||!p){ adminMsg.style.display='block'; adminMsg.textContent='Enter username and password'; return; } adminMsg.style.display='block'; adminMsg.style.color='var(--muted)'; adminMsg.textContent='Authentication request submitted (server required).'; setTimeout(()=>{ modalBack.style.display='none'; modalBack.setAttribute('aria-hidden','true'); adminMsg.style.display='none'; },900); });

  // update URL param
  function updateUrlParam(app){ try{ const u=new URL(location.href); u.searchParams.set('app', app); history.replaceState(null,'',u.toString()); }catch(e){} }

  // hide suggestion box on click outside
  document.addEventListener('click',(ev)=>{ if(!suggestionBox.contains(ev.target) && ev.target!==searchInput) suggestionBox.style.display='none'; });

  // Dev helper: you can uncomment next line for local testing (simulate signed in)
  // window.signedInUser={email:"demo@example.com",name:"Demo User"}; renderGoogleButton(); enableSearchIfAllowed();

  </script>
</body>
</html>