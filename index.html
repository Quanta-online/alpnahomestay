<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alpana Homestay - Managerial Aptitude Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a365d;
            --secondary: #2c5282;
            --accent: #e53e3e;
            --light: #f7fafc;
            --dark: #1a202c;
            --success: #38a169;
            --warning: #dd6b20;
            --info: #3182ce;
            --bg-gradient: linear-gradient(135deg, #1a365d, #2c5282);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: var(--light);
            overflow-x: hidden;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background-image 1s ease-in-out;
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-gradient);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
        }

        .splash-logo {
            width: 200px;
            margin-bottom: 2rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Permission Modal */
        .permission-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            color: white;
        }

        .permission-box {
            background: white;
            color: var(--dark);
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Instruction Screen */
        .instruction-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1500;
            color: white;
            padding: 2rem;
            overflow-y: auto;
        }

        /* Main Exam Container */
        .container {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header-content {
            background: var(--bg-gradient);
            padding: 2rem;
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        /* Question Container */
        .question-container {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
            position: relative;
        }

        /* Print Button */
        .print-btn {
            position: absolute;
            top: 1rem;
            right: 4rem;
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .question-container {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <img src="new.png" alt="Alpana Homestay Logo" class="splash-logo">
        <h1>Alpana Homestay</h1>
        <p>Managerial Aptitude Test</p>
    </div>

    <!-- Permission Modal -->
    <div class="permission-modal" id="permissionModal">
        <div class="permission-box">
            <h2>Exam Requirements</h2>
            <p>To maintain exam integrity, please grant the following permissions:</p>
            <div class="permission-item">
                <h3>Camera Access</h3>
                <p>Required for proctoring during the exam</p>
            </div>
            <div class="permission-item">
                <h3>Microphone Access</h3>
                <p>Required for audio monitoring</p>
            </div>
            <div class="permission-item">
                <h3>Location Access</h3>
                <p>Required to verify exam location</p>
            </div>
            <button class="btn btn-primary" id="grantPermissions">Grant Permissions</button>
            <button class="btn btn-danger" id="denyPermissions">Deny & Exit</button>
        </div>
    </div>

    <!-- Instruction Screen -->
    <div class="instruction-screen" id="instructionScreen">
        <div class="instruction-content">
            <h2>Exam Instructions</h2>
            <ol>
                <li>This exam consists of 100 multiple-choice questions.</li>
                <li>You have 120 minutes to complete the exam.</li>
                <li>There is negative marking (0.33 deducted for wrong answers).</li>
                <li>Do not switch tabs or applications during the exam.</li>
                <li>Your camera and microphone will be monitored throughout.</li>
                <li>Any suspicious activity will result in exam termination.</li>
                <li>The passing score is 55%.</li>
            </ol>
            <button class="btn btn-primary" id="startExam">Start Exam</button>
        </div>
    </div>

    <!-- Main Exam Container -->
    <div class="container" id="examContainer">
        <header>
            <div class="header-content">
                <h1>Managerial Aptitude Test</h1>
                <div class="test-info">
                    <div class="info-item">
                        <strong>Time Remaining</strong>
                        <span id="timeDisplay">120:00</span>
                    </div>
                    <div class="info-item">
                        <strong>Questions</strong>
                        <span id="questionCount">1/100</span>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="question-container">
            <div id="questionDisplay"></div>
            
            <div class="controls">
                <button class="btn btn-outline" id="prevBtn">Previous</button>
                <button class="btn btn-primary" id="nextBtn">Next</button>
            </div>
        </div>
        
        <div class="controls" style="justify-content: flex-end;">
            <button class="btn btn-danger" id="submitBtn">Submit Exam</button>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal-overlay" id="resultModal">
        <div class="modal-content">
            <button class="print-btn" id="printBtn">Print Results</button>
            <button class="close-modal" id="closeModal">&times;</button>
            <div class="result-header">
                <h2>Exam Results</h2>
                <p>Managerial Aptitude Test - Alpana Homestay</p>
            </div>
            
            <div class="score-card">
                <div class="score-item correct">
                    <h3 id="correctAnswers">0</h3>
                    <p>Correct Answers</p>
                </div>
                <div class="score-item incorrect">
                    <h3 id="incorrectAnswers">0</h3>
                    <p>Incorrect Answers</p>
                </div>
                <div class="score-item">
                    <h3 id="unanswered">0</h3>
                    <p>Unanswered</p>
                </div>
                <div class="score-item percentage">
                    <h3 id="percentage">0%</h3>
                    <p>Score Percentage</p>
                </div>
            </div>
            
            <div class="verdict" id="verdict"></div>
            
            <div class="answersheet">
                <h3>Detailed Analysis</h3>
                <div id="answersheetContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Answer Key
        const answerKey = {
            1: "a", 2: "b", 3: "c", 4: "d", 5: "a", 6: "b", 7: "c", 8: "d", 9: "a", 10: "b",
            // ... (all 100 questions with answers)
            100: "d"
        };

        // Exam Questions (100 questions)
        const examQuestions = [
            {
                question: "What is the primary responsibility of a hotel manager during peak season?",
                options: [
                    "Ensuring optimal staff allocation and guest satisfaction",
                    "Focusing only on revenue generation",
                    "Reducing operational costs",
                    "Delegating all responsibilities to assistants"
                ],
                explanation: "During peak season, a hotel manager must balance staff allocation and guest satisfaction as top priorities."
            },
            // ... (add all 100 questions in this format)
            {
                question: "What is the most effective way to handle a guest complaint about room cleanliness?",
                options: [
                    "Apologize sincerely, offer immediate cleaning, and provide compensation",
                    "Explain your cleaning procedures",
                    "Blame the housekeeping staff",
                    "Ignore the complaint"
                ],
                explanation: "A sincere apology with immediate corrective action and appropriate compensation is the professional approach."
            }
        ];

        // Background Images
        const bgImages = [
            "url('hotel1.jpg')",
            "url('hotel2.jpg')",
            "url('hotel3.jpg')",
            "url('hotel4.jpg')",
            "url('hotel5.jpg')"
        ];

        // System State
        let userAnswers = {};
        let currentQuestion = 1;
        let timerInterval;
        let timeLeft = 120 * 60;
        let examSubmitted = false;
        let permissionsGranted = false;
        let cameraStream;
        let micStream;

        // DOM Elements
        const elements = {
            splashScreen: document.getElementById('splashScreen'),
            permissionModal: document.getElementById('permissionModal'),
            instructionScreen: document.getElementById('instructionScreen'),
            examContainer: document.getElementById('examContainer'),
            questionDisplay: document.getElementById('questionDisplay'),
            questionNav: document.getElementById('questionNav'),
            timeDisplay: document.getElementById('timeDisplay'),
            questionCount: document.getElementById('questionCount'),
            resultModal: document.getElementById('resultModal'),
            printBtn: document.getElementById('printBtn')
        };

        // Initialize Exam
        function initExam() {
            // Start background image rotation
            let currentBg = 0;
            setInterval(() => {
                currentBg = (currentBg + 1) % bgImages.length;
                document.body.style.backgroundImage = bgImages[currentBg];
            }, 10000);

            // Start timer
            startTimer();
            
            // Load first question
            loadQuestion(currentQuestion);
            
            // Request full screen
            document.documentElement.requestFullscreen().catch(err => {
                console.log("Fullscreen error: ", err);
            });
        }

        // Permission Handling
        document.getElementById('grantPermissions').addEventListener('click', async () => {
            try {
                // Request camera access
                cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
                
                // Request microphone access
                micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // Request location access
                await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject);
                });
                
                permissionsGranted = true;
                elements.permissionModal.style.display = 'none';
                showInstructions();
                
            } catch (error) {
                alert("All permissions are required to take this exam. You will now be logged out.");
                window.location.reload();
            }
        });

        document.getElementById('denyPermissions').addEventListener('click', () => {
            alert("You cannot take the exam without granting permissions.");
            window.location.reload();
        });

        // Show Instructions
        function showInstructions() {
            elements.instructionScreen.style.display = 'flex';
        }

        document.getElementById('startExam').addEventListener('click', () => {
            elements.instructionScreen.style.display = 'none';
            elements.examContainer.style.display = 'block';
            initExam();
        });

        // Timer Functions
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0 && !examSubmitted) {
                    clearInterval(timerInterval);
                    submitExam();
                    alert("Time's up! Your exam has been automatically submitted.");
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            elements.timeDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        // Question Loading
        function loadQuestion(questionNum) {
            const questionData = examQuestions[questionNum - 1];
            
            let questionHTML = `
                <div class="question">
                    <div class="question-text">${questionNum}. ${questionData.question}</div>
                    <div class="options">
            `;
            
            ['a', 'b', 'c', 'd'].forEach((option, index) => {
                const isSelected = userAnswers[questionNum] === option;
                questionHTML += `
                    <div class="option ${isSelected ? 'selected' : ''}" 
                         onclick="selectOption(${questionNum}, '${option}')">
                        <input type="radio" name="q${questionNum}" 
                               ${isSelected ? 'checked' : ''}>
                        ${questionData.options[index]}
                    </div>
                `;
            });
            
            questionHTML += `</div></div>`;
            elements.questionDisplay.innerHTML = questionHTML;
            elements.questionCount.textContent = `${questionNum}/100`;
        }

        // Option Selection
        window.selectOption = function(questionNum, optionLetter) {
            if (!examSubmitted && !userAnswers[questionNum]) {
                userAnswers[questionNum] = optionLetter;
                loadQuestion(questionNum);
            }
        };

        // Exam Submission
        function submitExam() {
            examSubmitted = true;
            clearInterval(timerInterval);
            
            // Stop camera and microphone
            if (cameraStream) cameraStream.getTracks().forEach(track => track.stop());
            if (micStream) micStream.getTracks().forEach(track => track.stop());
            
            // Show results immediately
            showResults();
        }

        // Results Calculation
        function calculateResults() {
            let correct = 0, incorrect = 0, unanswered = 0, score = 0;
            
            for (let i = 1; i <= 100; i++) {
                if (!userAnswers[i]) {
                    unanswered++;
                } else if (userAnswers[i] === answerKey[i]) {
                    correct++;
                    score += 1;
                } else {
                    incorrect++;
                    score -= 0.33;
                }
            }
            
            return {
                correct,
                incorrect,
                unanswered,
                score: Math.max(0, score),
                percentage: Math.round((score / 100) * 100),
                passed: score >= 55
            };
        }

        // Show Results
        function showResults() {
            elements.examContainer.style.display = 'none';
            
            const results = calculateResults();
            
            document.getElementById('correctAnswers').textContent = results.correct;
            document.getElementById('incorrectAnswers').textContent = results.incorrect;
            document.getElementById('unanswered').textContent = results.unanswered;
            document.getElementById('percentage').textContent = `${results.percentage}%`;
            
            const verdict = document.getElementById('verdict');
            verdict.textContent = results.passed 
                ? `Congratulations! You passed with ${results.score.toFixed(2)}/100` 
                : `You scored ${results.score.toFixed(2)}/100. Please try again.`;
            verdict.className = results.passed ? "verdict pass" : "verdict fail";
            
            // Generate answer sheet
            const answersheet = document.getElementById('answersheetContent');
            answersheet.innerHTML = '';
            for (let i = 1; i <= 100; i++) {
                const item = document.createElement('div');
                item.className = 'answer-item';
                item.innerHTML = `
                    <div class="answer-status ${userAnswers[i] === answerKey[i] ? 'correct' : 'incorrect'}">
                        Q${i}: ${userAnswers[i] || 'Not Attempted'} (Correct: ${answerKey[i]})
                    </div>
                    <p>${examQuestions[i-1].explanation}</p>
                `;
                answersheet.appendChild(item);
            }
            
            // Show modal
            elements.resultModal.style.display = 'flex';
        }

        // Print Results
        elements.printBtn.addEventListener('click', () => {
            window.print();
        });

        // Close Modal
        document.getElementById('closeModal').addEventListener('click', () => {
            elements.resultModal.style.display = 'none';
        });

        // Start with splash screen
        setTimeout(() => {
            elements.splashScreen.style.display = 'none';
            elements.permissionModal.style.display = 'flex';
        }, 3000);

        // Anti-cheating measures
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden' && !examSubmitted) {
                alert("Warning: Tab switch detected. This incident has been recorded.");
                submitExam();
            }
        });

        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            alert("Right-click is disabled during the exam.");
        });

        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && (e.key === 'c' || e.key === 'C')) {
                e.preventDefault();
                alert("Copying is disabled during the exam.");
            }
        });
    </script>
</body>
</html>